<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smile AI - Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-100 h-screen flex flex-col">

    <header class="p-4 bg-white border-b flex justify-between items-center shadow-sm">
        <span class="font-bold text-blue-600">Smile AI Pro</span>
        <div id="u-img" class="w-8 h-8 rounded-full overflow-hidden border"></div>
    </header>

    <div id="chat-win" class="flex-1 overflow-y-auto p-4 space-y-4"></div>

    <div class="p-4 bg-white border-t">
        <div class="flex items-center gap-2 bg-gray-100 p-2 rounded-full px-4">
            <input id="inp" class="flex-1 bg-transparent outline-none p-1" placeholder="Puchiye ya Mic use karein...">
            <button onclick="startMic()" id="mic-btn" class="text-gray-500 hover:text-blue-600"><i class="fa-solid fa-microphone text-xl"></i></button>
            <button onclick="send()" class="text-blue-600 font-bold"><i class="fa-solid fa-paper-plane text-xl"></i></button>
        </div>
    </div>

    <script>
        // Firebase Config (Aapki Key)
        const firebaseConfig = {
            apiKey: "AIzaSyAos_jqEHQ_urQiOQsxg2m_pNJBjor0CZQ",
            authDomain: "smileai-24.firebaseapp.com",
            projectId: "smileai-24",
            appId: "1:470315069061:web:31ccd87455ae19cc05c3ec"
        };
        firebase.initializeApp(firebaseConfig);

        firebase.auth().onAuthStateChanged(user => {
            if(user) document.getElementById('u-img').innerHTML = `<img src="${user.photoURL}">`;
            else window.location.reload(); // Simple redirect logic
        });

        // VOICE RECOGNITION (Mic Function)
        function startMic() {
            const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'hi-IN';
            document.getElementById('mic-btn').classList.add('text-red-500');
            
            recognition.onresult = (event) => {
                const text = event.results[0][0].transcript;
                document.getElementById('inp').value = text;
                send();
            };
            
            recognition.onend = () => {
                document.getElementById('mic-btn').classList.remove('text-red-500');
            };
            recognition.start();
        }

        async function send() {
            const inp = document.getElementById('inp');
            const win = document.getElementById('chat-win');
            const val = inp.value.trim();
            if(!val) return;

            win.innerHTML += `<div class="text-right"><span class="bg-blue-600 text-white p-2 px-4 rounded-lg inline-block">${val}</span></div>`;
            inp.value = "";
            
            const aiB = document.createElement('div');
            aiB.innerHTML = `<span class="bg-white p-2 px-4 rounded-lg border inline-block">Smile AI Soch raha hai...</span>`;
            win.appendChild(aiB);

            try {
                const r = await fetch('https://smile-financial-service-ai.onrender.com/chat', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ message: val })
                });
                const d = await r.json();
                aiB.innerHTML = `<span class="bg-white p-2 px-4 rounded-lg border inline-block">${d.reply}</span>`;
            } catch (e) {
                aiB.innerText = "Connection Error!";
            }
            win.scrollTop = win.scrollHeight;
        }
    </script>
</body>
</html>
