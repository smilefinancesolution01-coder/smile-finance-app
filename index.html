<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smile AI - Mission 20 Lakh</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // Aapka Real Config
        const firebaseConfig = {
            apiKey: "AIzaSyAos_jqEHQ_urQiOQsxg2m_pNJBjor0CZQ",
            authDomain: "smileai-24.firebaseapp.com",
            projectId: "smileai-24",
            storageBucket: "smileai-24.firebasestorage.app",
            messagingSenderId: "470315069061",
            appId: "1:470315069061:web:31ccd87455ae19cc05c3ec"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        // Login Function
        window.handleLogin = async () => {
            try {
                await signInWithPopup(auth, provider);
            } catch (error) {
                console.error("Login Error", error);
                alert("Login fail ho gaya, internet check karein!");
            }
        };

        // Logout Function
        window.handleLogout = () => signOut(auth);

        // Auth Listener (Check if user is logged in)
        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('userName').innerText = user.displayName;
                document.getElementById('userPic').src = user.photoURL;
                console.log("Logged in user:", user.email);
            } else {
                document.getElementById('loginOverlay').style.display = 'flex';
            }
        });
    </script>

    <style>
        body { background: #0b0b0b; color: #fff; font-family: 'Inter', sans-serif; overflow: hidden; height: 100vh; }
        .sidebar { width: 260px; background: #161616; transition: 0.3s; }
        .sidebar.closed { margin-left: -260px; }
        .main { flex: 1; display: flex; flex-direction: column; background: #0b0b0b; position: relative; }
        .login-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 20px; }
        .input-bar { background: #202123; border: 1px solid #444; border-radius: 24px; padding: 8px 16px; margin: 20px; }
        .ai-text { background: linear-gradient(70deg, #4285f4, #9b72cb, #d96570); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    </style>
</head>
<body class="flex">

    <div id="loginOverlay" class="login-overlay">
        <h1 class="text-4xl font-bold ai-text mb-4 italic">Smile AI</h1>
        <p class="text-gray-400 mb-8">Bhai, pehle login karein taaki aapki shopping aur chat safe rahe.</p>
        <button onclick="handleLogin()" class="bg-white text-black px-6 py-3 rounded-full font-bold flex items-center gap-3 hover:bg-gray-200 transition">
            <img src="https://www.google.com/favicon.ico" class="w-5"> Login with Google
        </button>
    </div>

    <div class="sidebar border-r border-gray-800 flex flex-col" id="side">
        <div class="p-6 text-2xl font-bold ai-text italic">Smile AI</div>
        <div class="flex-1 overflow-y-auto px-4 space-y-1">
            <p class="text-[10px] text-gray-500 font-bold uppercase mb-2">Shopping Center</p>
            <div onclick="shop('Clothes')" class="p-2 hover:bg-gray-800 rounded cursor-pointer text-sm"><i class="fa-solid fa-shirt mr-3 text-blue-400"></i>Fashion</div>
            <div onclick="shop('Mobiles')" class="p-2 hover:bg-gray-800 rounded cursor-pointer text-sm"><i class="fa-solid fa-mobile mr-3 text-yellow-400"></i>Electronics</div>
            <div onclick="shop('Medicine')" class="p-2 hover:bg-gray-800 rounded cursor-pointer text-sm"><i class="fa-solid fa-pills mr-3 text-green-400"></i>Health</div>
        </div>
        <div class="p-4 border-t border-gray-800">
            <div class="flex items-center gap-3 mb-4">
                <img id="userPic" class="w-8 h-8 rounded-full border border-gray-600">
                <span id="userName" class="text-xs truncate font-medium">Aarif Bhai</span>
            </div>
            <button onclick="handleLogout()" class="text-xs text-red-500"><i class="fa-solid fa-sign-out mr-2"></i>Logout</button>
        </div>
    </div>

    <div class="main">
        <header class="p-4 border-b border-gray-900 flex justify-between items-center">
            <i class="fa-solid fa-bars cursor-pointer" onclick="document.getElementById('side').classList.toggle('closed')"></i>
            <span class="text-xs text-gray-500 font-mono italic">Partner ID: smileai24-21</span>
        </header>

        <div class="flex-1 overflow-y-auto p-6" id="chat">
            <div id="welcome" class="max-w-2xl mx-auto mt-10">
                <h2 class="text-4xl font-bold mb-4">Shubh Din, <span class="ai-text">Smile AI</span> ready hai.</h2>
                <p class="text-gray-400">Aapka mission 20 Lakh shuru hota hai. Kuch bhi pucho ya kharido!</p>
            </div>
            <div id="msgs" class="max-w-3xl mx-auto space-y-6"></div>
        </div>

        <div class="input-bar max-w-3xl mx-auto flex items-center w-[90%] mb-10">
            <input id="q" type="text" placeholder="Kya help chahiye, Bhai?" class="bg-transparent flex-1 outline-none text-sm" onkeypress="if(event.key=='Enter') send()">
            <i onclick="send()" class="fa-solid fa-paper-plane text-blue-500 cursor-pointer ml-4"></i>
        </div>
    </div>

    <script>
        const TAG = "smileai24-21";
        function shop(t) { window.open(`https://www.amazon.in/s?k=${t}&tag=${TAG}`, '_blank'); }

        async function send() {
            const q = document.getElementById('q').value;
            if(!q) return;
            document.getElementById('welcome').style.display = 'none';
            const msgs = document.getElementById('msgs');
            msgs.innerHTML += `<div class="flex justify-end"><span class="bg-[#303132] px-4 py-2 rounded-2xl text-sm">${q}</span></div>`;
            document.getElementById('q').value = "";

            try {
                const res = await fetch('https://smile-financial-service-ai.onrender.com/chat', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({message: q})
                });
                const d = await res.json();
                msgs.innerHTML += `<div class="flex gap-3"><div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-[10px] font-bold">S</div><div class="bg-transparent px-4 py-2 rounded-2xl text-sm leading-relaxed">${d.reply}</div></div>`;
                document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;
            } catch(e) { console.log(e); }
        }
    </script>
</body>
</html>
